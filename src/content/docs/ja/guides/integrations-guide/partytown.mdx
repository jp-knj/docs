---
type: integration
title: '@astrojs/partytown'
description: Astroプロジェクトで@astrojs/partytownインテグレーションを使用する方法を学びます。
sidebar:
  label: Partytown
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/partytown/'
category: other
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';

この**[Astroインテグレーション][astro-integration]**は、Astroプロジェクトで[Partytown](https://partytown.builder.io/)を有効にします。

## Astro Partytownを使う理由

Partytownは、リソース集約的なスクリプトを[Web Worker](https://developer.mozilla.org/ja/docs/Web/API/Web_Workers_API)に移動し、[メインスレッド](https://developer.mozilla.org/ja/docs/Glossary/Main_thread)から外すことを支援する遅延読み込みライブラリです。

アナリティクスや広告などのサードパーティスクリプトを使用している場合、Partytownはそれらがサイトの速度を低下させないようにする優れた方法です。

Astro Partytownインテグレーションは、Partytownをインストールし、すべてのページで有効になるようにします。

## インストール

Astroには、公式インテグレーションのセットアップを自動化する`astro add`コマンドが含まれています。お好みに応じて、代わりに[手動でインテグレーションをインストール](#manual-install)することもできます。

新しいターミナルウィンドウで次のコマンドのいずれかを実行してください。

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add partytown
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add partytown
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add partytown
  ```
  </Fragment>
</PackageManagerTabs>

問題が発生した場合は、[GitHubで報告](https://github.com/withastro/astro/issues)していただき、以下の手動インストール手順を試してください。

### 手動インストール

まず、`@astrojs/partytown`パッケージをインストールします。

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm install @astrojs/partytown
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm add @astrojs/partytown
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn add @astrojs/partytown
  ```
  </Fragment>
</PackageManagerTabs>

次に、`integrations`プロパティを使用して、`astro.config.*`ファイルにインテグレーションを適用します。

```js title="astro.config.mjs" ins={2} ins="partytown()"
import { defineConfig } from 'astro/config';
import partytown from '@astrojs/partytown';

export default defineConfig({
  // ...
  integrations: [partytown()],
});
```

## 使用方法

Partytownは設定不要で使用できるはずです。サイトに既存のサードパーティスクリプトがある場合は、`type="text/partytown"`属性を追加してみてください。

```html ins="type="text/partytown""
<script type="text/partytown" src="fancy-analytics.js"></script>
```

[ブラウザーの開発者ツール](https://developer.chrome.com/docs/devtools/open/)から「ネットワーク」タブを開くと、`partytown`プロキシがこのリクエストをインターセプトしていることが確認できます。

## 設定

このインテグレーションを設定するには、`astro.config.mjs`の`partytown()`関数呼び出しに「config」オブジェクトを渡します。

```js title="astro.config.mjs" {5-7}
export default defineConfig({
  // ...
  integrations: [
    partytown({
      config: {
        // オプションをここに記述
      },
    }),
  ],
});
```

これは[Partytownの設定オブジェクト](https://partytown.builder.io/configuration)と同じです。

### config.debug

Partytownには`debug`モードが搭載されています。`config.debug`に`true`または`false`を渡すことで有効または無効にできます。[`debug`モード](https://partytown.builder.io/debugging)が有効になっている場合、ブラウザーコンソールに詳細なログが出力されます。

このオプションが設定されていない場合、`debug`モードは[dev](/ja/reference/cli-reference/#astro-dev)または[preview](/ja/reference/cli-reference/#astro-preview)モードではデフォルトで有効になります。

```js title="astro.config.mjs" {6}
export default defineConfig({
  // ...
  integrations: [
    partytown({
      // 例：デバッグモードを無効にする
      config: { debug: false },
    }),
  ],
});
```

### config.forward

サードパーティスクリプトは通常、サイト全体でそれらと通信できるよう`window`オブジェクトに変数を追加します。しかし、スクリプトがWeb Workerで読み込まれる場合、グローバルな`window`オブジェクトにアクセスできません。

これを解決するために、Partytownは変数をグローバルなwindowオブジェクトに「パッチ」し、適切なスクリプトに転送できます。

転送する変数は`config.forward`オプションで指定できます。[Partytownのドキュメントで詳細を読む。](https://partytown.builder.io/forwarding-events)

```js title="astro.config.mjs" {7}
export default defineConfig({
  // ...
  integrations: [
    partytown({
      // 例：dataLayer.pushを転送イベントとして追加
      config: {
        forward: ['dataLayer.push'],
      },
    }),
  ],
});
```

## 例

* [GitHubでAstro Partytownを使用したプロジェクトを閲覧](https://github.com/search?q=%22%40astrojs%2Fpartytown%22+path%3A**%2Fpackage.json\&type=code)して、さらなる例を確認してください！

[astro-integration]: /ja/guides/integrations-guide/