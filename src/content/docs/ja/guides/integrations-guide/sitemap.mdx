---
type: integration
title: '@astrojs/sitemap'
description: Astroプロジェクトで@astrojs/sitemapインテグレーションを使用する方法を学びます。
sidebar:
  label: Sitemap
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/sitemap/'
category: other
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';

この **[Astroインテグレーション][astro-integration]** は、Astroプロジェクトをビルドする際にページに基づいてサイトマップを生成します。

## Astro Sitemapを使う理由

サイトマップ (Sitemap) は、サイト上のすべてのページ、動画、ファイルを概説するXMLファイルです。Googleなどのサーチエンジンがこのファイルを読み取り、サイトをより効率的にクロールします。詳細については、[サイトマップに関するGoogleの公式ガイダンス](https://developers.google.com/search/docs/advanced/sitemaps/overview)を参照してください。

サイトマップファイルは、大規模なマルチページサイトに推奨されます。サイトマップを使用しない場合でも、ほとんどのサーチエンジンはサイトのページを一覧表示できますが、サイトマップは、サイトが可能な限り検索エンジンフレンドリーであることを保証する優れた方法です。

Astro Sitemapを使用すると、このXMLファイルを自分で作成する必要がありません。Astro Sitemapインテグレーションが静的に生成されたルートをクロールし、`getStaticPaths()`によって生成される`[...slug]`や`src/pages/[lang]/[version]/info.astro`などの[動的ルート](/ja/guides/routing/#動的ルート)を含むサイトマップファイルを作成します。

このインテグレーションは、[SSRモード](/ja/guides/on-demand-rendering/)の動的ルートに対してサイトマップエントリを生成できません。

## インストール

Astroには、公式インテグレーションのセットアップを自動化する`astro add`コマンドが含まれています。お好みに応じて、代わりに[手動でインテグレーションをインストール](#手動インストール)することもできます。

新しいターミナルウィンドウで以下のコマンドのいずれかを実行してください。

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add sitemap
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add sitemap
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add sitemap
  ```
  </Fragment>
</PackageManagerTabs>

何か問題が発生した場合は、[GitHubでお気軽にご報告](https://github.com/withastro/astro/issues)いただき、以下の手動インストール手順をお試しください。

### 手動インストール

まず、パッケージマネージャーを使用して`@astrojs/sitemap`パッケージをインストールします。

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm install @astrojs/sitemap
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm add @astrojs/sitemap
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn add @astrojs/sitemap
  ```
  </Fragment>
</PackageManagerTabs>

次に、`integrations`プロパティを使用してインテグレーションを`astro.config.*`ファイルに適用します。

```js ins={2} ins="sitemap()"
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  // ...
  integrations: [sitemap()],
});
```

## 使用方法

`@astrojs/sitemap`は、サイトマップを生成するためにサイトのデプロイされたURLを知る必要があります。

`astro.config.mjs`に[`site`](/ja/reference/configuration-reference/#site)オプションとしてサイトのURLを追加してください。これは`http://`または`https://`で始まる必要があります。

```js title="astro.config.mjs" {5}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://stargazers.club',
  integrations: [sitemap()],
  // ...
});
```

サイトマップインテグレーションが設定されると、サイトをビルドする際に出力ディレクトリに`sitemap-index.xml`と`sitemap-0.xml`ファイルが追加されます。

`sitemap-index.xml`は、すべての番号付きサイトマップファイルにリンクします。
`sitemap-0.xml`は、サイト上のページを一覧表示します。
非常に大きなサイトの場合、`sitemap-1.xml`と`sitemap-2.xml`のような追加の番号付きファイルもある可能性があります。

<details>
<summary>2ページのウェブサイトの生成ファイルの例</summary>

```xml title="sitemap-index.xml"
<?xml version="1.0" encoding="UTF-8"?>
  <sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <sitemap>
    <loc>https://stargazers.club/sitemap-0.xml</loc>
  </sitemap>
</sitemapindex>
```

```xml title="sitemap-0.xml"
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:news="http://www.google.com/schemas/sitemap-news/0.9" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:image="http://www.google.com/schemas/sitemap-image/1.1" xmlns:video="http://www.google.com/schemas/sitemap-video/1.1">
  <url>
    <loc>https://stargazers.club/</loc>
  </url>
  <url>
    <loc>https://stargazers.club/second-page/</loc>
  </url>
</urlset>
```
</details>

### サイトマップの発見

サイトの`<head>`と`robots.txt`ファイルにリンクを含めることで、クローラーがサイトマップを見つけやすくできます。

#### `<head>`内のサイトマップリンク

サイトマップインデックスファイルを指す`<link rel="sitemap">`要素をサイトの`<head>`に追加します。

```html title="src/layouts/Layout.astro" ins={2}
<head>
  <link rel="sitemap" href="/sitemap-index.xml" />
</head>
```

#### `robots.txt`内のサイトマップリンク

ウェブサイトに`robots.txt`がある場合、サイトマップインデックスのURLを追加してクローラーを支援できます。

```txt ins={5}
# public/robots.txt
User-agent: *
Allow: /

Sitemap: https://<YOUR SITE>/sitemap-index.xml
```

`astro.config.mjs`の`site`値を再利用したい場合は、`robots.txt`を動的に生成することもできます。
`public/`ディレクトリの静的ファイルを使用する代わりに、`src/pages/robots.txt.ts`ファイルを作成し、以下のコードを追加します。

```ts title="src/pages/robots.txt.ts"
import type { APIRoute } from 'astro';

const getRobotsTxt = (sitemapURL: URL) => `
User-agent: *
Allow: /

Sitemap: ${sitemapURL.href}
`;

export const GET: APIRoute = ({ site }) => {
  const sitemapURL = new URL('sitemap-index.xml', site);
  return new Response(getRobotsTxt(sitemapURL));
};
```

## 設定

このインテグレーションを設定するには、`astro.config.mjs`の`sitemap()`関数にオブジェクトを渡します。

```js title="astro.config.mjs" {6-8}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  integrations: [
    sitemap({
      // 設定オプション
    }),
  ],
});
```

### filter

デフォルトでは、すべてのページがサイトマップに含まれます。カスタム`filter`関数を追加することで、URLによって含めるページをフィルタリングできます。

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://stargazers.club',
  integrations: [
    sitemap({
      filter: (page) => page !== 'https://stargazers.club/secret-vip-lounge/',
    }),
  ],
});
```

この関数は、サイト上のすべてのページに対して呼び出されます。`page`関数パラメータは、`site`ドメインを含む、現在検討中のページの完全なURLです。ページをサイトマップに含めるには`true`を、除外するには`false`を返します。

複数のページをフィルタリングするには、対象URLで引数を追加します。

```js title="astro.config.mjs" {8-12}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://stargazers.club',
  integrations: [
    sitemap({
      filter: (page) =>
        page !== 'https://stargazers.club/secret-vip-lounge-1/' &&
        page !== 'https://stargazers.club/secret-vip-lounge-2/' &&
        page !== 'https://stargazers.club/secret-vip-lounge-3/' &&
        page !== 'https://stargazers.club/secret-vip-lounge-4/',
    }),
  ],
});
```

### customPages

場合によっては、ページがデプロイされたサイトの一部であっても、Astroプロジェクトの一部ではないことがあります。Astroによって作成されて*いない*ページをサイトマップに含めたい場合は、このオプションを使用できます。

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://stargazers.club',
  integrations: [
    sitemap({
      customPages: ['https://stargazers.club/external-page', 'https://stargazers.club/external-page2'],
    }),
  ],
});
```

### entryLimit

サイトマップファイルあたりの最大エントリ数。デフォルト値は45000です。エントリ数が多い場合、サイトマップインデックスと複数のサイトマップが作成されます。この[大きなサイトマップの分割に関する説明](https://developers.google.com/search/docs/advanced/sitemaps/large-sitemaps)を参照してください。

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://stargazers.club',
  integrations: [
    sitemap({
      entryLimit: 10000,
    }),
  ],
});
```

### changefreq、lastmod、priority

これらのオプションは、[サイトマップXML仕様](https://www.sitemaps.org/protocol.html)の`<changefreq>`、`<lastmod>`、`<priority>`タグに対応します。

`changefreq`と`priority`はGoogleによって無視されることに注意してください。

。。。note
Astroの[インテグレーションAPI](/ja/reference/integrations-reference/)の制限により、このインテグレーションは特定のページのソースコードを分析できません。この設定オプションは、*サイト全体*の基準で`changefreq`、`lastmod`、`priority`を設定できます。これらの値をページごとに設定する方法については、次のオプション**serialize**を参照してください。
。。。

```js title="astro.config.mjs" ins={8-10}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://stargazers.club',
  integrations: [
    sitemap({
      changefreq: 'weekly',
      priority: 0.7,
      lastmod: new Date('2022-02-24'),
    }),
  ],
});
```

### serialize

ディスクに書き込む直前に各サイトマップエントリに対して呼び出される関数。この関数は非同期にできます。

パラメータとして`SitemapItem`オブジェクトを受け取り、次のプロパティを持つことができます。

* `url`（絶対ページURL）。これは`SitemapItem`にあることが保証されている唯一のプロパティです。
* `changefreq`
* `lastmod`（ISO形式の日付、`String`タイプ）
* `priority`
* `links`。

この`links`プロパティには、親ページを含む代替ページの`LinkItem`リストが含まれています。

`LinkItem`タイプには2つのフィールドがあります。`url`（指定された言語のこのページのバージョンの完全修飾URL）と`lang`（このページのバージョンが対象とするサポートされている言語コード）。

`serialize`関数は、変更されたかどうかに関係なく`SitemapItem`を返す必要があります。

以下の例は、サイトマップ固有のプロパティを個別に追加する機能を示しています。

```js title="astro.config.mjs" ins={8-18}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://stargazers.club',
  integrations: [
    sitemap({
      serialize(item) {
        if (/exclude-from-sitemap/.test(item.url)) {
          return undefined;
        }
        if (/your-special-page/.test(item.url)) {
          item.changefreq = 'daily';
          item.lastmod = new Date();
          item.priority = 0.9;
        }
        return item;
      },
    }),
  ],
});
```

### i18n

サイトマップをローカライズするには、この`i18n`オプションにオブジェクトを渡します。

このオブジェクトには2つの必須プロパティがあります。

* `defaultLocale`。 `String`。その値は`locales`キーの1つとして存在する必要があります。
* `locales`。 `Record<String, String>`、キー/値ペア。キーはページパス内のロケール部分を検索するために使用されます。値は言語属性で、英字とハイフンのみが許可されます。

[言語属性についての詳細](https://developer.mozilla.org/ja/docs/Web/HTML/Global_attributes/lang)を読む。

[ローカライゼーションについての詳細](https://developers.google.com/search/docs/advanced/crawling/localized-versions#all-method-guidelines)を読む。

```js title="astro.config.mjs" ins={8-15}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://stargazers.club',
  integrations: [
    sitemap({
      i18n: {
        defaultLocale: 'en', // `https://stargazers.club/`の後に`es`または`fr`が含まれていないすべてのURLは、デフォルトロケール（`en`）として扱われます
        locales: {
          en: 'en-US', // `defaultLocale`値は`locales`キーに存在する必要があります
          es: 'es-ES',
          fr: 'fr-CA',
        },
      },
    }),
  ],
});
```

結果のサイトマップは次のようになります。

```xml title="sitemap-0.xml"
...
  <url>
    <loc>https://stargazers.club/</loc>
    <xhtml:link rel="alternate" hreflang="en-US" href="https://stargazers.club/"/>
    <xhtml:link rel="alternate" hreflang="es-ES" href="https://stargazers.club/es/"/>
    <xhtml:link rel="alternate" hreflang="fr-CA" href="https://stargazers.club/fr/"/>
  </url>
  <url>
    <loc>https://stargazers.club/es/</loc>
    <xhtml:link rel="alternate" hreflang="en-US" href="https://stargazers.club/"/>
    <xhtml:link rel="alternate" hreflang="es-ES" href="https://stargazers.club/es/"/>
    <xhtml:link rel="alternate" hreflang="fr-CA" href="https://stargazers.club/fr/"/>
  </url>
  <url>
    <loc>https://stargazers.club/fr/</loc>
    <xhtml:link rel="alternate" hreflang="en-US" href="https://stargazers.club/"/>
    <xhtml:link rel="alternate" hreflang="es-ES" href="https://stargazers.club/es/"/>
    <xhtml:link rel="alternate" hreflang="fr-CA" href="https://stargazers.club/fr/"/>
  </url>
  <url>
    <loc>https://stargazers.club/es/second-page/</loc>
    <xhtml:link rel="alternate" hreflang="es-ES" href="https://stargazers.club/es/second-page/"/>
    <xhtml:link rel="alternate" hreflang="fr-CA" href="https://stargazers.club/fr/second-page/"/>
    <xhtml:link rel="alternate" hreflang="en-US" href="https://stargazers.club/second-page/"/>
  </url>
...
```

### xslURL

サイトマップをスタイリングして美化するXSLスタイルシートのURL。

設定値は、ローカルスタイルシートの設定された`site` URLに対する相対パス、または外部スタイルシートへの絶対URLリンクのいずれかです。

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://example.com',
  integrations: [
    sitemap({
      xslURL: '/sitemap.xsl'
    }),
  ],
});
```

### filenameBase

サイトマップXMLファイルを生成する際に使用される名前プレフィックス文字列。デフォルト値は`sitemap`です。

このオプションは、既存のサイトマップファイルがあるドメインにAstroサイトを統合する際に役立つ場合があります。

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://stargazers.club',
  integrations: [
    sitemap({
      filenameBase: 'astronomy-sitemap'
    }),
  ],
});
```

指定された設定により、`https://stargazers.club/astronomy-sitemap-0.xml`と`https://stargazers.club/astronomy-sitemap-index.xml`にサイトマップファイルが生成されます。

## 例

* 公式Astroウェブサイトは、Astro Sitemapを使用して[そのサイトマップ](https://astro.build/sitemap-index.xml)を生成しています。
* より多くの例については、[GitHubでAstro Sitemapを使ったプロジェクトを参照](https://github.com/search?q=%22%40astrojs%2Fsitemap%22+path%3Apackage.json\&type=Code)してください！

[astro-integration]: /ja/guides/integrations-guide/