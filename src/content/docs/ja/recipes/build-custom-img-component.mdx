---
title: カスタム画像コンポーネントの構築
description: getImage関数を使用して、メディアクエリをサポートするカスタム画像コンポーネントを構築する方法を学びます。
type: recipe
i18nReady: false
---
import { Steps } from '@astrojs/starlight/components';

Astroには、画像の表示と最適化に使用できる2つの組み込みコンポーネントが用意されています。`<Picture>`コンポーネントを使用すると、レスポンシブ画像を表示し、さまざまな形式やサイズを扱うことができます。`<Image>`コンポーネントは画像を最適化し、さまざまな形式や品質プロパティを渡すことができます。

`<Picture>`や`<Image>`コンポーネントが現在サポートしていないオプションが必要な場合は、`getImage()`関数を使用してカスタムコンポーネントを作成できます。

このレシピでは、[`getImage()`関数](/ja/guides/images/#generating-images-with-getimage)を使用して、メディアクエリに基づいて異なるソース画像を表示する独自のカスタム画像コンポーネントを作成します。

## レシピ

<Steps>
1. 新しいAstroコンポーネントを作成し、`getImage()`関数をインポートします。

    ```astro title="src/components/MyCustomImageComponent.astro"
    ---
     import { getImage } from "astro:assets";
    ---

    ```

2. カスタム画像用に新しいコンポーネントを作成します。`MyCustomComponent.astro`は`Astro.props`から3つの`props`を受け取ります。`mobileImgUrl`と`desktopImgUrl`プロパティは、異なるビューポートサイズで画像を作成するために使用されます。`alt`プロパティは、画像のaltテキストに使用されます。これらのプロパティは、カスタム画像コンポーネントをレンダリングする場所ならどこでも渡されます。以下のインポートを追加し、コンポーネントで使用するプロパティを定義します。TypeScriptを使用してプロパティを型付けすることもできます。

    ```astro title="src/components/MyCustomImageComponent.astro" ins={3, 11}
    ---
    import type { ImageMetadata } from "astro";
    import { getImage } from "astro:assets";

    interface Props {
        mobileImgUrl: string | ImageMetadata;
        desktopImgUrl: string | ImageMetadata;
        alt: string;
    }

    const { mobileImgUrl, desktopImgUrl, alt } = Astro.props;
    ---

    ```

3. `getImage()`関数に必要なプロパティを指定して呼び出し、レスポンシブ画像をそれぞれ定義します。

    ```astro title="src/components/MyCustomImageComponent.astro" ins={13-18, 20-25}
    ---
    import type { ImageMetadata } from "astro";
    import { getImage } from "astro:assets";

    interface Props {
        mobileImgUrl: string | ImageMetadata;
        desktopImgUrl: string | ImageMetadata;
        alt: string;
    }

    const { mobileImgUrl, desktopImgUrl, alt } = Astro.props;

    const mobileImg = await getImage({
        src: mobileImgUrl,
        format: "webp",
        width: 200,
        height: 200,
    });

    const desktopImg = await getImage({
        src: desktopImgUrl,
        format: "webp",
        width: 800,
        height: 200,
    });
    ---

    ```

4. 目的のメディアクエリに基づいて、異なる画像を持つ`srcset`を生成する`<picture>`要素を作成します。

    ```astro title="src/components/MyCustomImageComponent.astro" ins={28-32}
    ---
    import type { ImageMetadata } from "astro";
    import { getImage } from "astro:assets";

    interface Props {
        mobileImgUrl: string | ImageMetadata;
        desktopImgUrl: string | ImageMetadata;
        alt: string;
    }

    const { mobileImgUrl, desktopImgUrl, alt } = Astro.props;

    const mobileImg = await getImage({
        src: mobileImgUrl,
        format: "webp",
        width: 200,
        height: 200,
    });

    const desktopImg = await getImage({
        src: desktopImgUrl,
        format: "webp",
        width: 800,
        height: 200,
    });
    ---

    <picture>
        <source media="(max-width: 799px)" srcset={mobileImg.src} />
        <source media="(min-width: 800px)" srcset={desktopImg.src} />
        <img src={desktopImg.src} alt={alt} />
    </picture>

    ```

5. 任意の`.astro`ファイルで`<MyCustomImageComponent />`をインポートして使用します。異なるビューポートサイズで2つの異なる画像を生成するために必要なプロパティを必ず渡してください。

    ```astro title="src/pages/index.astro"
    ---
    import MyCustomImageComponent from "../components/MyCustomImageComponent.astro";
    import mobileImage from "../images/mobile-profile-image.jpg";
    import desktopImage from "../images/desktop-profile-image.jpg";
    ---

    <MyCustomImageComponent
        mobileImgUrl={mobileImage}
        desktopImgUrl={desktopImage}
        alt="user profile picture"
    />

    ```
</Steps>