---
title: アイランドアーキテクチャ
description: Astroのアイランドアーキテクチャがサイトを高速に保つ仕組みを学びます。
i18nReady: true
---

import IslandsDiagram from '~/components/IslandsDiagram.astro';

Astroは、**アイランド**（Islands）と呼ばれるフロントエンドアーキテクチャを開拓し、普及させました。アイランドアーキテクチャは、モノリシックなJavaScriptのパターンを避け、ページから不要なJavaScriptをすべて自動的に削除することで、フロントエンドのパフォーマンスを向上させます。開発者は、Astroと一緒にお気に入りのUIコンポーネントやフレームワークを使い続けながらも、なおこうしたメリットを得られます。

## 簡単な歴史

「コンポーネントアイランド」という用語は、Etsyのフロントエンドアーキテクトである[Katie Sylor-Miller](https://sylormiller.com/)によって2019年に作られました。その後このアイデアは拡張され、Preactの作者であるJason Millerによる2020年8月11日の[この記事](https://jasonformat.com/islands-architecture/)によって文書化されました。

> 「アイランド」アーキテクチャの基本的な考え方は驚くほどシンプルです。サーバーでHTMLページをレンダリングし、高度に動的な領域にはプレースホルダーやスロットを挿入しておきます。そしてクライアント上では、サーバーでレンダリングされたHTMLを再利用して、その領域に小さな自己完結型のウィジェットを「ハイドレーション」します。  
> — Jason Miller、Preactの作者

このアーキテクチャパターンがベースとしている技術は、**パーシャル（partial）ハイドレーション**や**選択的（selective）ハイドレーション**としても知られています。

対照的に、JavaScriptベースのウェブフレームワークの多くは、1つの大きなJavaScriptアプリケーション（シングルページアプリケーション、SPAとも呼ばれます）として、ウェブサイト全体をハイドレーションしてレンダリングします。SPAはシンプルでパワフルですが、クライアントサイドのJavaScriptが増えるため、ページロードパフォーマンスの問題に悩まされることになります。

SPAは特定の状況においては有用であり、[Astroページの中に埋め込む](/ja/guides/migrate-to-astro/from-create-react-app/)こともできます。しかし、SPAには、選択的かつ戦略的にハイドレーションするためのネイティブな機能がないため、現在ウェブ上にある多くのプロジェクトにとっては過剰な選択肢となってしまいます。

Astroは、Sylor-Millerが作り出したコンポーネントアイランドパターンを使い、選択的ハイドレーションを組み込んだ最初のメインストリームのJavaScriptウェブフレームワークとして人気となりました。

## アイランドとは

Astroにおける「アイランド」（Islands）とは、静的なHTMLページ上で強化されたUIコンポーネントを指します。

[**クライアントアイランド**](#client-islands)はページ全体とは独立してハイドレーションされるインタラクティブなJavaScript UIコンポーネントであり、[**サーバーアイランド**](#server-islands)はページ全体とは別に動的コンテンツをサーバーレンダリングするUIコンポーネントです。

どちらのアイランドもコンポーネント単位で負荷の高い処理を独立して実行し、ページロードを最適化します。

## アイランドコンポーネント

Astroコンポーネントはページテンプレートを構成する基本要素です。クライアントサイドのランタイムを持たず、静的HTMLとしてレンダリングされます。

クライアントアイランドは、静的で軽量なサーバーレンダリングHTMLの海に浮かぶインタラクティブウィジェットと考えてください。サーバーアイランドを追加すると、ログイン中の訪問者のプロフィール画像のようなパーソナライズされた動的要素をサーバーレンダリングで表示できます。

<IslandsDiagram>
  <Fragment slot="headerApp">ヘッダー（インタラクティブアイランド）</Fragment>
  <Fragment slot="sidebarApp">サイドバー（静的HTML）</Fragment>
  <Fragment slot="main">
      テキスト、画像などの静的コンテンツ
  </Fragment>
  <Fragment slot="carouselApp">画像カルーセル（インタラクティブアイランド）</Fragment>
  <Fragment slot="footer">フッター（静的HTML）</Fragment>
  <Fragment slot="source">出典：[Islands Architecture: Jason Miller](https://jasonformat.com/islands-architecture/)</Fragment>
</IslandsDiagram>

各アイランドは常にページ上の他のアイランドから独立して動作します。ページ上に複数のアイランドを存在させることもできます。またアイランドは、それぞれ異なるコンポーネントコンテキストで実行されているにもかかわらず、状態を共有したり、互いに通信することが可能です。

この柔軟性により、Astroは、[React](https://react.dev/)、[Preact](https://preactjs.com/)、[Svelte](https://svelte.dev/)、[Vue](https://vuejs.org/)、[SolidJS](https://www.solidjs.com/)などの複数のUIフレームワークをサポートしています。それぞれが独立しているため、1つのページで複数のフレームワークを混在させることすら可能です。

:::tip
多くの開発者は1つのUIフレームワークに固執しますが、Astroでは同じプロジェクト内で複数のフレームワークを使用できます。これにより、以下のことが可能となります。

- コンポーネントごとに最適なフレームワークを選択する。
- 新しくプロジェクトを作成する必要なしに、新しいフレームワークを学ぶ。
- 異なるフレームワークを使いながら、他の人と協力する。
- 既存のサイトを別のフレームワークへと、ダウンタイム無しで段階的に移行する。
:::

## アイランドを作成する

デフォルトでは、AstroはすべてのUIコンポーネントをHTMLとCSSのみへと自動的にレンダリングし、**クライアントサイドのJavaScriptを自動的に取り除きます。**


```astro title="src/pages/index.astro"
<MyReactComponent />
```

これは厳しく聞こえるかもしれませんが、この挙動により、Astroウェブサイトはデフォルトで高速となり、またウェブサイトのパフォーマンスを低下させる可能性のある不要なJavaScriptを開発者が誤って送信することを防ぎます。

静的なUIコンポーネントをインタラクティブなアイランドに変換するには、`client:*`ディレクティブを追加します。これによりAstroは、パフォーマンスの最適化のために、クライアントサイドのJavaScriptを自動的にビルドしてバンドルします。

```astro title="src/pages/index.astro" ins="client:load"
<!-- このコンポーネントは、ページ上でインタラクティブになります！ 
     ウェブサイトの残りの部分は静的なままです。 -->
<MyReactComponent client:load />
```

アイランドでは、クライアントサイドのJavaScriptは、`client:*`ディレクティブを使って明示的にマークしたインタラクティブなコンポーネントに対してのみ読み込まれます。

また、インタラクティブにするかどうかはコンポーネント単位で設定されるため、各コンポーネントの使用状況に応じて読み込む優先度をそれぞれ指定できます。たとえば、`client:idle`は、ブラウザがアイドル状態になったときにコンポーネントをロードするように指示し、`client:visible`は、コンポーネントがビューポートに入ったとき初めてロードするように指示します。

## クライアントアイランド

AstroはデフォルトであらゆるUIコンポーネントをHTML&CSSのみでレンダリングし、**クライアントサイドJavaScriptを自動で取り除きます。**

```astro title="src/pages/index.astro"
<MyReactComponent />
```

一見厳しく思えるかもしれませんが、この挙動こそがAstroサイトを標準で高速に保ち、開発者が不要なJavaScriptを誤って送信してしまうのを防ぎます。

静的UIコンポーネントをインタラクティブアイランドに変えるには、`client:*`ディレクティブを付けるだけです。Astroが最適化された形でクライアントサイドJavaScriptを自動ビルド&バンドルします。

```astro title="src/pages/index.astro" ins="client:load"
<!-- このコンポーネントだけがインタラクティブになります。
     それ以外の部分は静的のままです。 -->
<MyReactComponent client:load />
```

アイランド方式では、`client:*`ディレクティブを付けたインタラクティブコンポーネントに対してのみJavaScriptが読み込まれます。

また、インタラクション設定はコンポーネント単位なので、用途に応じて読み込み優先度を細かく制御できます。たとえば`client:idle`はブラウザがアイドル状態になったときに、`client:visible`は要素がビューポートに入ったときにロードされます。

### クライアントアイランドの利点

- **高パフォーマンス**: サイトの大部分が高速な静的HTMLになり、必要な部分だけにJavaScriptを配信。  
- **並列ロード**: 低優先度アイランドが高優先度アイランドをブロックしません。  
- **細かな制御**: ディレクティブでロードタイミングを指定できます。

**クライアントアイランドはAstroが“デフォルトで高速”を実現する核心機能です。**

<ReadMore>プロジェクトで[JavaScriptフレームワークコンポーネント](/en/guides/framework-components/)を使う方法を詳しく読む</ReadMore>

## サーバーアイランド

これによりページは複数の小さなサーバーレンダリング領域に分割され、それぞれが並列にロードされます。

ページのメインコンテンツは汎用アバターなどのプレースホルダー付きで即座に表示され、アイランド本来のコンテンツが用意できしだい置き換わります。サーバーアイランドを利用すれば、少量のパーソナライズ要素があっても静的ページ全体の描画が遅延しません。

このレンダリングパターンはポータビリティを前提に設計されており、特定のサーバーインフラに依存しません。Dockerコンテナ上のNode.jsサーバーから任意のサーバーレスプロバイダーまで、あらゆるホストで動作します。

### サーバーアイランドの利点

- **動的部分をオンデマンドで描画**  
  ページ内で特に動的な領域だけを即時レンダリングできるため、外枠やメインコンテンツをより積極的にキャッシュでき、高速化につながります。

- **優れたユーザー体験**  
  サーバーアイランドは最適化されており、ブラウザがページを描画する前に読み込まれることもあります。アイランドが描画されるまでの短時間はカスタムフォールバックを表示してレイアウトシフトを防止できます。

Astroのサーバーアイランドが効果を発揮する例として、ECストアフロントがあります。商品ページのメインコンテンツは頻繁に変わりませんが、次のような動的要素を含むのが一般的です。

- ヘッダー内のユーザーアバター
- 商品の特別セール情報
- ユーザーレビュー

これらをサーバーアイランド化すると、訪問者は最も重要な「商品」をすぐに確認でき、パーソナライズ要素は準備が整いしだい置き換えられます。汎用アバターや読み込みスピナー、ストアのお知らせなどをフォールバックとして表示し、個別コンテンツが利用可能になるまで差し替えておくことが可能です。

<ReadMore>プロジェクトで[サーバーアイランド](/en/guides/server-islands/)を使う方法を詳しく読む</ReadMore>